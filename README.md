# ethers-deploy-or-attach

This package has been built to make the life of the average hardhat developer a little bit easier.

It is built _on top_ of the hardhat typechain plugin and its sole purpose is to ease the process of dealing with the typechain generated.

The final results:

```typescript
// Anywhere in your hardhat project
import Contracts from "../components/Contracts";

const myContract = await Contracts.MyContract.deploy(); // everything will be fully typed

// Anywhere is an external package importing your contracts package
import Contracts from "MyContracts"; // your contracts package
import { buildContracts } from "ethers-deploy-or-attach";

let contracts = buildContracts(Contracts).connect(mySigner);
const myContract = await Contracts.MyContract.deploy(); // everything will be fully typed
```

## Get started

### In your hardhat project

Install the package:

```
yarn add ethers-deploy-or-attach
```

At the root of your hardhat project, create a folder named `types`, then, inside of it, create a file called `index.ts`. Populate the file with all the contracts factories - generated by the typechain package - you want to use/export in your project, like so:

```typescript
import { Drop__factory, Store__factory } from "../typechain";

export default {
  Drop: Drop__factory,
  Store: Store__factory,
};
```

Once than this has been done. Create at the root of your hardhat project a folder `components` and create inside of it a file named `Contracts.ts`. Populate it with the following code:

```typescript
import { ethers } from "hardhat";

import { buildContracts } from "ethers-deploy-or-attach";

import Contracts from "../types";

export default buildContracts(Contracts, ethers);
```

Here is how you can use it, for exemple in your `/tests/` path:

```typescript
import Contracts from "../components/Contracts";

const myStore = await Contracts.Store.deploy(); // everything will be fully typed
```

Now, let's export your contracts properly for external uses.

In your hardhat project, add the following to your `package.json` and/or modify your file accordingly:

```json
{
  "name": "MyContracts",
   ...
  "main": "dist/types/index.js",
  "types": "dist/types/index.d.ts",
  "files": ["dist/**/*"],
  "scripts": {
    "build": "hardhat compile && yarn tsc -p tsconfig.build.json"
  }
}
```

Create a `tsconfig.build.json` file at the root of your hardhat project:

```json
{
  "extends": "./tsconfig.json",
  "include": ["./types"]
}
```

You can then run:

```
yarn build
```

From there all you have to do is publishing your package:

```
yarn publish
```

### In other projects wanting to use your published contracts

Install the package:

```
yarn add ethers-deploy-or-attach
```

And install your own contract package published above, here with our example:

```
yarn add MyContracts
```

Now, all you have to do in your project (in our case a Dapp built with Vite.js and React) is to import the needed library and just call one function:

```typescript
import Contracts from "MyContracts";

import { buildContracts } from "ethers-deploy-or-attach";

let contracts = buildContracts(Contracts);
```

> Warning, this first instance of contracts won't work from the get go. You need to call connect() first with an initial signer.

In our case something like:

```typescript
import Contracts from "MyContracts";

import { buildContracts } from "ethers-deploy-or-attach";

let contracts = buildContracts(Contracts);

const provider = new ethers.providers.Web3Provider(window.ethereum);
contracts = contracts.connect(provider.getSigner());
```
